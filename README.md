# Приложение для поиска медиафайлов

Веб-приложение для загрузки, транскрибации и поиска медиафайлов (аудио/видео) с использованием семантического поиска.

## Возможности

- Загрузка аудио и видео файлов
- Автоматическое преобразование в формат MP3
- Преобразование речи в текст
- Семантический поиск с использованием эмбеддингов
- Современный веб-интерфейс

## Процесс обработки файла

### 1. Загрузка файла
- Пользователь загружает аудио или видео файл через веб-интерфейс
- Файл сохраняется во временное хранилище на сервере
- Создается запись в базе данных с метаданными файла

### 2. Конвертация в MP3
- Если загружен видео файл, извлекается аудиодорожка
- Аудио конвертируется в формат MP3 для унификации
- Оригинальный файл сохраняется в хранилище

### 3. Транскрибация
- Аудио файл обрабатывается моделью Whisper для распознавания речи
- Генерируется текстовая транскрипция
- Транскрипция сохраняется в базе данных

### 4. Генерация эмбеддингов
- Текст транскрипции обрабатывается моделью Sentence Transformers
- Создаются векторные представления (эмбеддинги) текста
- Эмбеддинги сохраняются в базе данных для последующего поиска

### 5. Индексация для поиска
- Эмбеддинги индексируются для быстрого поиска
- Создаются связи между файлами и их векторными представлениями
- Система готова к семантическому поиску

### 6. Поиск по файлам
- Пользователь вводит поисковый запрос
- Запрос преобразуется в эмбеддинг
- Находятся наиболее похожие эмбеддинги из базы данных
- Возвращаются соответствующие медиафайлы с транскрипциями

## Требования

- Docker и Docker Compose
- ИЛИ:
  - Python 3.8+
  - Node.js 14+
  - PostgreSQL
  - FFmpeg (для обработки медиафайлов)

## Режимы работы

### Режим разработки (Development)

Для разработки используйте:
```bash
docker-compose -f docker-compose.dev.yml up --build
```

Особенности режима разработки:
- Автоматическая перезагрузка backend при изменении кода
- Hot-reload для frontend
- Монтирование исходного кода в контейнеры
- Сохранение node_modules в контейнере
- Отладочные логи

### Продакшн режим (Production)

Для продакшена используйте:
```bash
docker-compose up --build
```

Особенности продакшн режима:
- Оптимизированные сборки
- Минимизированные ресурсы
- Без отладочной информации
- Оптимизированные образы

## Настройка с использованием Docker (Рекомендуется)

1. Убедитесь, что Docker и Docker Compose установлены в вашей системе
2. Клонируйте репозиторий
3. Соберите и запустите контейнеры:
```bash
docker-compose up --build
```
4. Приложение будет доступно по адресам:
   - Фронтенд: http://localhost:3000
   - Backend API: http://localhost:8000
   - PostgreSQL: localhost:5432

Для остановки приложения:
```bash
docker-compose down
```

Для удаления всех данных (включая базу данных и загруженные файлы):
```bash
docker-compose down -v
```

## Ручная настройка

### Настройка Backend

1. Создайте виртуальное окружение:
```bash
python -m venv venv
source venv/bin/activate  # В Windows: venv\Scripts\activate
```

2. Установите зависимости:
```bash
pip install -r requirements.txt
```

3. Настройте базу данных PostgreSQL:
```bash
createdb media_search
```

4. Запустите backend сервер:
```bash
cd backend
uvicorn main:app --reload
```

### Настройка Frontend

1. Установите зависимости:
```bash
cd frontend
npm install
```

2. Запустите сервер разработки:
```bash
npm start
```

## Использование

1. Откройте браузер и перейдите по адресу `http://localhost:3000`
2. Загрузите медиафайлы с помощью кнопки "Upload Media"
3. Используйте поисковую строку для поиска контента в ваших медиафайлах
4. Просматривайте транскрипции и результаты поиска в интерфейсе

## API Endpoints

- `POST /upload` - Загрузка медиафайла
- `GET /search?query=<текст>` - Поиск по медиафайлам
- `GET /media` - Список всех медиафайлов

## Используемые технологии

- Backend:
  - FastAPI
  - PostgreSQL
  - Whisper (для распознавания речи)
  - Sentence Transformers (для эмбеддингов)
  - Pydub (для обработки аудио)

- Frontend:
  - React
  - Material-UI
  - Axios

## Компоненты Docker

Приложение контейнеризировано с использованием Docker со следующими сервисами:

1. Контейнер Frontend:
   - React приложение
   - Запускается на Node.js
   - Порт: 3000

2. Контейнер Backend:
   - FastAPI приложение
   - Python 3.9
   - FFmpeg для обработки медиафайлов
   - Порт: 8000

3. Контейнер Базы данных:
   - PostgreSQL 13
   - Постоянное хранилище для данных
   - Порт: 5432

## Хранение данных

- Данные базы хранятся в именованном томе: `postgres_data`
- Загруженные медиафайлы хранятся в именованном томе: `uploads`